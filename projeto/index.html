<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de contatos</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>


</head>

<script>

    var registro = -1

    $(function () {

        listar()

        $("#btnSalvar").click(function () {


            var contato = {
                nome: $('#txtNome').val(),
                idade: $('#txtIdade').val()
            }

            var contatos = JSON.parse(localStorage.getItem('contatos'))

            if (contatos == null) {
                contatos = []
            }

            if (registro > -1) {

                contatos[registro] = {
                    nome: $('#txtNome').val(),
                    idade: $('#txtIdade').val()
                }
            }
            else {
                contatos.push(contato)
            }

            localStorage.setItem('contatos', JSON.stringify(contatos))

            $('input').val('')
            $('#txtNome').focus()

            registro = -1

            listar();

        });

        $(document).on('click', '#btnEditar', function () {

            let posicao = $(this).attr("alt")

            registro = posicao

            let contatos = JSON.parse(localStorage.getItem('contatos'))

            let contato = contatos[posicao]

            $('#txtNome').val(contato.nome)
            $('#txtIdade').val(contato.idade)          

        })

    });


    function listar() {

        $('#tblContatos tr:not(:first)').remove();

        var contatos = JSON.parse(localStorage.getItem('contatos'))

        for (let posicao in contatos) {


            let contato = contatos[posicao]

            console.log(contato)


            // let colunaNome = '<td>' + contato.nome + '</td>'
            // let colunaIdade = '<td>' + contato.idade + '</td>'
            // let colunaAcoes = '<td></td>'
            // let linha = '<tr>' + colunaNome + colunaIdade + colunaAcoes + '</tr>'


            $('#tblContatos tr:last').after('<tr><td>' + contato.nome + '</td><td>' +
                contato.idade + '</td><td>' +
                '<button id="btnEditar" alt="' + posicao + '" class="btn btn-info btn-sm">Editar</button>' +
                '</td></tr>');

        }

    }

</script>


<body>

    <div class="container">
        <div class="row">
            <div class="panel panel-info">
                <div class="panel-heading text-center">
                    <h1>Lista de contatos</h1>
                </div>

                <div class="panel-body">

                    <div class="col-xs-12 col-md-6 col-lg-8">
                        <label for="txtNome">Nome</label>
                        <input id="txtNome" type="text" class="form-control">
                    </div>
                    <div class="col-xs-12 col-md-3 col-lg-2">
                        <label for="txtIdade">Idade</label>
                        <input id="txtIdade" type="text" class="form-control">
                    </div>

                    <div class="col-xs-12 col-md-3 col-lg-2">
                        <br>
                        <button id="btnSalvar" type="button" class="btn btn-primary">Salvar</button>
                    </div>
                    <br>
                    <hr>
                    <table id="tblContatos" class="table table-striped table-responsive table-hover">
                        <tbody>
                            <th>Nome</th>
                            <th>Idade</th>
                            <th>Ações</th>
                            <!-- <th colspan="2" align="center">Ações</th> -->
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>
    </div>
</body>

</html>